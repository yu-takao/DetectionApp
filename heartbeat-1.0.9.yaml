---
RecipeFormatVersion: '2020-01-25'
ComponentName: com.trust.heartbeat
ComponentVersion: 1.0.9
ComponentType: aws.greengrass.generic
ComponentDescription: Heartbeat publisher with proper QOS enum
ComponentPublisher: trust
ComponentConfiguration:
  DefaultConfiguration:
    thingName: "{iot:thingName}"
    intervalSec: 30
Manifests:
  - Platform:
      os: linux
      architecture: aarch64
    Lifecycle:
      Install:
        Script: |
          set -e
          python3 -m venv '/greengrass/v2/work/com.trust.heartbeat/venv' || true
          PY='/greengrass/v2/work/com.trust.heartbeat/venv/bin/python'; PIP='/greengrass/v2/work/com.trust.heartbeat/venv/bin/pip'; if [ ! -x "$PY" ]; then PY=python3; PIP=pip; fi
          $PY -m pip install --upgrade pip
          $PIP install --upgrade awsiotsdk awscrt
      Run:
        RequiresPrivilege: true
        Script: |
          PY='/greengrass/v2/work/com.trust.heartbeat/venv/bin/python'; if [ ! -x "$PY" ]; then PY=python3; fi; GG_THING_NAME="{configuration:/thingName}" HEARTBEAT_INTERVAL_SEC="{configuration:/intervalSec}" "$PY" {artifacts:path}/heartbeat.py
    Artifacts:
      - URI: s3://trust-kawasaki-gg-artifacts-405351594292-ap-northeast-1/com.trust.heartbeat/1.0.9/heartbeat.py
        Unarchive: NONE

