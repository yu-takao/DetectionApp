{
  "RecipeFormatVersion": "2020-01-25",
  "ComponentName": "com.trust.heartbeat",
  "ComponentVersion": "1.0.8",
  "ComponentType": "aws.greengrass.generic",
  "ComponentDescription": "Publish heartbeat to IoT Core periodically (with IPC permissions).",
  "ComponentConfiguration": {
    "DefaultConfiguration": {
      "accessControl": {
        "aws.greengrass.ipc.mqttproxy": {
          "com.trust.heartbeat:PublishToIoTCore:1": {
            "policyDescription": "Allow publishing heartbeat to IoT Core",
            "operations": ["aws.greengrass#PublishToIoTCore"],
            "resources": ["trust/heartbeat/kawasaki-1"]
          }
        }
      }
    }
  },
  "Manifests": [
    {
      "Artifacts": [
        { "URI": "s3://gg-artifacts-405351594292-ap-northeast-1/com.trust.heartbeat/1.0.8/heartbeat.py" }
      ],
      "Lifecycle": {
        "Install": {
          "Script": "set -e\npython3 -m venv '{work:path}/venv' || true\nPY='{work:path}/venv/bin/python'; PIP='{work:path}/venv/bin/pip'; if [ ! -x \"$PY\" ]; then PY=python3; PIP=pip; fi\n$PY -m pip install --upgrade pip\n$PIP install --upgrade awsiotsdk awscrt"
        },
        "Run": {
          "Script": "PY='{work:path}/venv/bin/python'; if [ ! -x \"$PY\" ]; then PY=python3; fi; GG_THING_NAME=\"{iot:thingName}\" HEARTBEAT_INTERVAL_SEC=\"30\" \"$PY\" {artifacts:path}/heartbeat.py",
          "RequiresPrivilege": true
        }
      }
    }
  ]
}
