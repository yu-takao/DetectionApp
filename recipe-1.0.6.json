{
  "RecipeFormatVersion": "2020-01-25",
  "ComponentName": "com.trust.heartbeat",
  "ComponentVersion": "1.0.6",
  "ComponentType": "aws.greengrass.generic",
  "ComponentDescription": "Publish heartbeat to IoT Core periodically (venv).",
  "Manifests": [
    {
      "Artifacts": [
        { "URI": "s3://gg-artifacts-405351594292-ap-northeast-1/com.trust.heartbeat/1.0.6/heartbeat.py" }
      ],
      "Lifecycle": {
        "Install": {
          "Script": "set -e\n# try venv; if unavailable, fallback to system pip with break flag\nif python3 -m venv '{work:path}/venv' 2>/dev/null; then\n  '{work:path}/venv/bin/python' -m pip install --upgrade pip\n  '{work:path}/venv/bin/pip' install --upgrade awsiot awscrt\nelse\n  python3 -m ensurepip --upgrade || true\n  python3 -m pip install --upgrade --break-system-packages awsiot awscrt\nfi"
        },
        "Run": {
          "Script": "PY='{work:path}/venv/bin/python'; if [ ! -x \"$PY\" ]; then PY=python3; fi; GG_THING_NAME=\"{iot:thingName}\" HEARTBEAT_INTERVAL_SEC=\"30\" \"$PY\" {artifacts:path}/heartbeat.py",
          "RequiresPrivilege": true
        }
      }
    }
  ]
}
